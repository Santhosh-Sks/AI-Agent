# Use the official n8n image
FROM n8nio/n8n:latest

# Create a data directory for workflows, nodes, and configs
RUN mkdir -p /data/custom-nodes /data/import

# Copy importable workflows into the image (optional)
COPY import /data/import

# Copy custom nodes into the image (optional)
COPY custom-nodes /data/custom-nodes

# Add a placeholder file to custom-nodes to avoid checksum errors
RUN mkdir -p /custom-nodes && echo "Placeholder file" > /custom-nodes/README.md

# Copy entrypoint script
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh

# Set n8n data folder
ENV N8N_USER_FOLDER=/data

# Use our entrypoint script
ENTRYPOINT ["/docker-entrypoint.sh"]
